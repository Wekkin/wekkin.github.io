## 计算机图形学概览

本文件总结了现代计算机图形学的核心概念、数学基础、几何表示、渲染管线、着色与光照、纹理采样、可见性与阴影、抗锯齿与后处理、全局光照与光线追踪、动画与形变、GPU 编程模型、性能优化、工程实践清单与延伸阅读。

---

## 1. 数学基础与空间变换

- **向量与矩阵**: 点、方向、法线；线性代数与仿射变换；4×4 齐次坐标矩阵。
- **坐标系与变换链**: 物体空间 → 世界空间 → 观察空间 → 裁剪/归一化设备空间 → 屏幕空间。
  - 常用组合: \( M_{vp} = P \cdot V \cdot M \)，点变换 \( p' = M_{vp} \cdot p \)。
- **投影**:
  - 透视投影: 近大远小；由视野(FOV)、宽高比、近远裁剪面控制。
  - 正交投影: 尺寸不随距离变化；用于 CAD/UI。
- **法线变换**: 使用上逆转置矩阵 \( N = (M^{-1})^{\top} \) 以保持角度关系。
- **颜色空间与伽马**:
  - 线性空间用于光照计算；显示设备通常为伽马空间。
  - sRGB 纹理读取需解伽马，最终输出再编码；避免“伽马双重/遗漏”误差。

---

## 2. 几何表示

- **三角网格**: 顶点(位置、法线、切线、UV)、索引缓冲、材质槽。
- **曲线与曲面**: Bézier、B-Spline、NURBS、细分曲面(Catmull–Clark)。
- **程序化与隐式**: SDF/TSDF、体素、程序化建模(L-System)。
- **点云与体数据**: 医学/科学可视化；体渲染需要传输函数与采样策略。
- **空间加速结构**: BVH、k-d tree、八叉树；用于相交测试、裁剪与渲染加速。

---

## 3. 现代 GPU 渲染管线(实时)

- **阶段**: 输入装配 → 顶点着色器 → 曲面细分(可选) → 几何着色器(可选) → 光栅化 → 片元着色器 → 输出合并。
- **着色器类型**: VS/HS/DS/GS/FS(PS)/CS；统一着色架构下语言有 GLSL/HLSL/MSL。
- **缓冲与绑定**: 顶点/索引缓冲、常量/统一缓冲、纹理/采样器、描述符集/根签名。
- **目标**: 以三角形为基本图元，将几何投影到屏幕像素并计算每个像素的最终颜色与深度。

---

## 4. 着色与光照

- **局部光照模型**:
  - Lambert 漫反射: \( f_d = \frac{\rho_d}{\pi} \)。
  - Phong/Blinn-Phong 高光: 经验型镜面高光项，实用但能量不守恒。
- **渲染方程**:
  \[ L_o(p, \omega_o) = L_e(p, \omega_o) + \int_{\Omega} f_r(p, \omega_i, \omega_o)\, L_i(p, \omega_i)\, (\mathbf{n}\cdot\omega_i)\, d\omega_i \]
- **基于物理的渲染(PBR)**:
  - 微表面模型: 法线分布函数 D、几何函数 G、菲涅尔项 F；常用 GGX/Trowbridge–Reitz。
  - Schlick 菲涅尔近似: \( F(\cos\theta) = F_0 + (1 - F_0)(1-\cos\theta)^5 \)。
  - 金属-非金属工作流: 基础色(BaseColor)/金属度(Metallic)/粗糙度(Roughness)/法线/环境光遮蔽(AO)。
- **环境照明**: IBL，使用预过滤环境贴图(PMREM)和 BRDF 积分 LUT 实现实时近似。

---

## 5. 纹理与采样

- **类型**: 颜色、法线(切线空间)、粗糙度、金属度、位移/视差、环境贴图、噪声。
- **采样与过滤**: 最近邻、双线性、三线性、各向异性；Mipmapping 抑制远处摩尔纹。
- **坐标与展开**: UV 展开、无缝拼接、三平面投射；切线空间一致性对法线贴图至关重要。
- **压缩与格式**: BCn/ASTC/ETC，KTX2；HDR 使用 RGBE、RGBM 或浮点/半精度(如 EXR, FP16)。

---

## 6. 可见性、深度与阴影

- **可见性**: 背面剔除、视锥裁剪、遮挡裁剪、Z-Buffer/反向 Z。
- **阴影技术**:
  - 阴影映射: 基础深度图、PCF、PCSS、VSM/EVSM、级联阴影(CSM)。
  - 阴影体: 体素化或几何体积外壳，成本高、实时较少用。

---

## 7. 抗锯齿与后处理

- **抗锯齿**: MSAA(几何级)、TAA(时域)、SMAA/FXAA(后处理)；TAA 需运动矢量与抖动策略。
- **后处理效果**: HDR、Bloom、色调映射(ACES、Reinhard)、景深、运动模糊、屏幕空间环境光遮蔽(SSAO/HBAO/SSGI)。
- **颜色管理**: 工作空间线性化，显示转换(OETF/EOTF)，遵守 sRGB/Display P3；避免在伽马空间进行光照。

---

## 8. 全局光照与离线渲染

- **蒙特卡洛积分**: 路径追踪、双向路径追踪(BDPT)、能量守恒与无偏估计；重要性采样与多重重要性采样(MIS)。
- **光子映射/辐射度**: 半全局或近似全局方法；缓存与渐进式策略(PPM)。
- **体渲染**: 体积散射、相函数(Henyey–Greenstein)、单次/多次散射。
- **神经渲染**: NeRF/3DGS 等将辐射场参数化以实现新视角合成与压缩表示。

---

## 9. 实时光线追踪

- **API 与着色器阶段**: DXR、Vulkan RT；RayGen、Miss、ClosestHit、AnyHit、Intersection。
- **加速结构**: BLAS/TLAS、更新策略(构建/重构/Refit)；实例化与变换继承。
- **混合渲染**: Raster + RT 结合阴影、反射、AO；与时域重投影和去噪(SVGF、NRD、OIDN)配合。

---

## 10. 动画与形变

- **骨骼蒙皮**: 线性混合蒙皮(LBS)与双四元数蒙皮(DQ Skinning)；姿态矩阵与层级变换。
- **形态混合**: 面部/表情与局部修形；与骨骼权重叠加。
- **物理驱动**: 刚体、软体、布料与流体；位置约束与迭代求解(PBD/XPBD)。
- **运动学**: 正向/逆向运动学(FK/IK)与 CCD/FABRIK 算法。

---

## 11. GPU 编程模型与 API

- **图形 API**: OpenGL(易用)、Direct3D(Windows/Xbox)、Vulkan(金属级、显式)、Metal(Apple)。
- **着色语言**: GLSL/HLSL/MSL；跨平台中间表示 SPIR-V；着色器编译与反射。
- **资源与同步**: 管线状态对象(PSO)、描述符/绑定、内存屏障、队列与多线程记录；调优需要 Profiler 与标记。
- **计算着色**: GPGPU、后处理、粒子/网格剔除；与图形队列协同。

---

## 12. 性能优化要点

- **批处理与实例化**: 减少 Draw/Dispatch 次数；大物体优先，远物体合批。
- **裁剪与 LOD**: 视锥/遮挡裁剪、基于屏幕尺寸的 LOD 与 Impostor。
- **带宽与缓存**: 压缩纹理、紧凑顶点格式、合理布局(SoA/AoS)；避免随机访问。
- **着色复杂度**: 早期深度测试、分层 Z、延迟/前向+ 渲染架构的取舍。
- **并行与流水**: CPU/GPU 并行、异步上传、持久映射；避免 pipeline bubble。

---

## 13. 工程实践清单

- 渲染前确保: 线性空间、相机矩阵正确、反向 Z + 浮点深度、背面剔除与视锥裁剪开启。
- PBR 资源: 切线空间一致、金属度与介质 F0 合理(如 0.04)、粗糙度线性空间存储。
- 阴影: 统一深度偏移、稳定级联分布、PCF 尺寸与分布匹配分辨率。
- TAA: 抖动序列(如 Halton)、运动矢量精确、历史裁剪与权重调度。
- HDR: 浮点渲染目标、曝光控制、ACES 近似曲线、在显示输出处做伽马编码。
- 调试: 逐阶段可视化(G-Buffer/阴影贴图/法线/运动矢量)；启用 GPU 标记与截帧工具(RenderDoc、PIX、Nsight)。

---

## 14. 常见陷阱

- 在伽马空间做光照或混合导致能量错误与发灰感。
- 法线贴图切线空间不一致引起高光拉丝与接缝。
- 深度精度不足靠近近裁剪面；未使用反向 Z 或合理分布的近远平面。
- 阴影偏移过小/过大导致彼得潘或自阴影；级联边界抖动。
- TAA 幽灵与拖影：运动矢量错误、历史权重过高或响应不当。

---

## 15. 延伸阅读与资源

- 书籍
  - [Real‑Time Rendering, 4th Edition](https://www.realtimerendering.com/)
  - [Physically Based Rendering: From Theory to Implementation (PBRT)](https://pbrt.org/)
  - [Fundamentals of Computer Graphics](https://www.crcpress.com/Fundamentals-of-Computer-Graphics/Pharr/p/book/9780367654061)
- 课程/讲义
  - [MIT 6.837 Computer Graphics](https://ocw.mit.edu/courses/6-837-computer-graphics-fall-2012/)
  - [UPenn CIS 560/561 Advanced Rendering](https://www.seas.upenn.edu/~cis5610/)
  - [LearnOpenGL](https://learnopengl.com/)
  - [The Graphics Programming Handbook](https://www.shaderfrog.com/blog/2021/03/23/graphics-programming-handbook)
- 规范/格式
  - [glTF 2.0 Specification](https://www.khronos.org/gltf/)
  - [Vulkan Specification](https://www.khronos.org/registry/vulkan/)
  - [DirectX 12 & DXR](https://learn.microsoft.com/en-us/windows/win32/direct3d12/directx-12-programming-guide)

---

## 16. 术语速查

- IBL: Image-Based Lighting，基于环境纹理的全局光照近似。
- BRDF/BSDF: 双向反射/散射分布函数；能量守恒与半角向量参数化。
- GGX: 常用粗糙微表面法线分布函数，尾部更长适合金属高光。
- BLAS/TLAS: 实时光追的底层/顶层加速结构，管理几何与实例。
- PSO: 管线状态对象；绑定固定功能与着色器，便于驱动缓存。

---

最后更新: 以本文件为学习与实施导引，具体实现需结合目标平台、性能预算与内容制作流程。